<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.bus-Mapper">
	
	<!--  
	<select id="busCheck" parameterType="BusVO" resultType="busVO">
		select * from bus where start_tr=#{start_tr} and end_tr=#{end_tr} and arrive_time=#{arrive_time}
	</select>
	-->
	
	<!-- 배차 및 잔여 좌석 수 조회 -->
	<select id="busCheck" parameterType="busVO" resultType="busVO">
		<![CDATA[
			select bus_no, start_tr, end_tr, company, arrive_time, time, payment, 
    			   (select count(*) from seat where bus_no = bus.bus_no and ticket_no is null) as bus_seats from bus
			where start_tr = #{start_tr} 
			and end_tr = #{end_tr} 
			and arrive_time < 2400 
			and arrive_time >= #{arrive_time}
		]]>
	</select>
	
	<select id="timeCheck" parameterType="String" resultType="String">
		<![CDATA[
			select bus_no from bus where arrive_time < #{arrive_time}
		]]>
	</select>
	
	<select id="busListCount" parameterType="busVO" resultType="int">
		<![CDATA[
			select count(*) as buscount from bus 
			where start_tr = #{start_tr}
				and end_tr = #{end_tr}
				and arrive_time < 2400 
				and arrive_time >= #{arrive_time}
		]]>
	</select>
	
	<!-- 버스 정보 수정 -->
	<update id="busUpdate" parameterType="busVO">
		update bus set start_tr = #{start_tr}
					 , end_tr = #{end_tr}
					 , company = #{company}
					 , arrive_time = #{arrive_time}
					 , time = #{time}
					 , payment = #{payment}
		where bus_no = #{bus_no}
	</update>


	<!-- 버스터미널 목록 조회 -->
	<select id="busList" resultType="busVO">
			select DISTINCT start_tr end_tr from bus
	</select>
	
	<!-- 지역 목록 조회 -->
	<select id="regionList" resultType="terminalVO">
		 select DISTINCT region from terminal
	</select>
	<!-- 지역 목록 드롭다운 선택시 리스트 조회 -->
	<select id="terminalList" resultType="terminalVO" parameterType="String">
		 select name from terminal where region=#{region}
	</select>
	
</mapper>